name: SEO Optimization & Static Pages Generation

on:
  push:
    branches: [ main ]
  workflow_dispatch:

# ğŸ”§ é—œéµï¼šæ¬Šé™è¨­å®š
permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  seo-optimization:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Generate static redirect pages
      run: |
        # ç”Ÿæˆ about.html
        cat > about.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
          <meta charset="UTF-8">
          <title>é—œæ–¼ä½œè€… | AIOGEO çŸ¥è­˜åº«</title>
          <meta name="description" content="å»–å¤©ä½‘ Bless Liao - GEO (ç”Ÿæˆå¼å¼•æ“å„ªåŒ–) å°ˆå®¶ï¼Œå°ˆç²¾AIæœå°‹å„ªåŒ–ç­–ç•¥èˆ‡å…§å®¹æ¶æ§‹è¨­è¨ˆ">
          <meta http-equiv="refresh" content="0; url=https://bless25min.github.io/AIOGEO-Knowledge/#/about">
          <link rel="canonical" href="https://bless25min.github.io/AIOGEO-Knowledge/#/about">
          <script>window.location.href='https://bless25min.github.io/AIOGEO-Knowledge/#/about';</script>
        </head>
        <body>
          <h1>é—œæ–¼ä½œè€… - AIOGEO çŸ¥è­˜åº«</h1>
          <p>æ­£åœ¨é‡å®šå‘åˆ° <a href="https://bless25min.github.io/AIOGEO-Knowledge/#/about">é—œæ–¼ä½œè€…é é¢</a></p>
          <p>å¦‚æœæ²’æœ‰è‡ªå‹•è·³è½‰ï¼Œè«‹é»æ“Šä¸Šæ–¹é€£çµã€‚</p>
        </body>
        </html>
        EOF
        
        # ç”Ÿæˆ contributing.html
        cat > contributing.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
          <meta charset="UTF-8">
          <title>åƒèˆ‡è²¢ç» | AIOGEO çŸ¥è­˜åº«</title>
          <meta name="description" content="åŠ å…¥ AIOGEO çŸ¥è­˜åº«å»ºè¨­ï¼Œå…±åŒæ¨å‹• GEO é ˜åŸŸç™¼å±•ã€‚æä¾›è²¢ç»æŒ‡å—èˆ‡æœ€ä½³å¯¦å‹™">
          <meta http-equiv="refresh" content="0; url=https://bless25min.github.io/AIOGEO-Knowledge/#/contributing">
          <link rel="canonical" href="https://bless25min.github.io/AIOGEO-Knowledge/#/contributing">
          <script>window.location.href='https://bless25min.github.io/AIOGEO-Knowledge/#/contributing';</script>
        </head>
        <body>
          <h1>åƒèˆ‡è²¢ç» - AIOGEO çŸ¥è­˜åº«</h1>
          <p>æ­£åœ¨é‡å®šå‘åˆ° <a href="https://bless25min.github.io/AIOGEO-Knowledge/#/contributing">åƒèˆ‡è²¢ç»é é¢</a></p>
          <p>å¦‚æœæ²’æœ‰è‡ªå‹•è·³è½‰ï¼Œè«‹é»æ“Šä¸Šæ–¹é€£çµã€‚</p>
        </body>
        </html>
        EOF
        
    - name: Generate optimized sitemap
      run: |
        cat > sitemap.xml << 'EOF'
        <?xml version="1.0" encoding="UTF-8"?>
        <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/</loc>
                <lastmod>REPLACE_DATE</lastmod>
                <changefreq>weekly</changefreq>
                <priority>1.0</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/about.html</loc>
                <lastmod>REPLACE_DATE</lastmod>
                <changefreq>monthly</changefreq>
                <priority>0.8</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/contributing.html</loc>
                <lastmod>REPLACE_DATE</lastmod>
                <changefreq>monthly</changefreq>
                <priority>0.6</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/#!/about</loc>
                <lastmod>REPLACE_DATE</lastmod>
                <changefreq>monthly</changefreq>
                <priority>0.7</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/#!/posts/geo-fundamentals</loc>
                <lastmod>REPLACE_DATE</lastmod>
                <changefreq>weekly</changefreq>
                <priority>0.9</priority>
            </url>
        </urlset>
        EOF
        
        # æ›¿æ›æ—¥æœŸ
        sed -i "s/REPLACE_DATE/$(date +%Y-%m-%d)/g" sitemap.xml
        
    - name: Generate robots.txt
      run: |
        cat > robots.txt << 'EOF'
        User-agent: *
        Allow: /
        
        Sitemap: https://bless25min.github.io/AIOGEO-Knowledge/sitemap.xml
        
        User-agent: GPTBot
        Allow: /
        
        User-agent: Claude-Web
        Allow: /
        
        User-agent: PerplexityBot
        Allow: /
        EOF
        
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ğŸ¤– è‡ªå‹•ç”Ÿæˆ SEO å„ªåŒ–æª”æ¡ˆ - $(date +%Y-%m-%d)"
          git push
        fi
