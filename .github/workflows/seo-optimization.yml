name: SEO Optimization & Static Pages Generation

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  seo-optimization:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Generate static redirect pages
      run: |
        # 建立靜態重定向頁面目錄
        mkdir -p static-pages
        
        # 生成 about.html
        cat > about.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
          <meta charset="UTF-8">
          <title>關於作者 | AIOGEO 知識庫</title>
          <meta name="description" content="廖天佑 Bless Liao - GEO (生成式引擎優化) 專家，專精AI搜尋優化策略與內容架構設計">
          <meta http-equiv="refresh" content="0; url=https://bless25min.github.io/AIOGEO-Knowledge/#/about">
          <link rel="canonical" href="https://bless25min.github.io/AIOGEO-Knowledge/#/about">
          <script>window.location.href='https://bless25min.github.io/AIOGEO-Knowledge/#/about';</script>
        </head>
        <body>
          <h1>關於作者 - AIOGEO 知識庫</h1>
          <p>正在重定向到 <a href="https://bless25min.github.io/AIOGEO-Knowledge/#/about">關於作者頁面</a></p>
          <p>如果沒有自動跳轉，請點擊上方連結。</p>
        </body>
        </html>
        EOF
        
        # 生成 contributing.html
        cat > contributing.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
          <meta charset="UTF-8">
          <title>參與貢獻 | AIOGEO 知識庫</title>
          <meta name="description" content="加入 AIOGEO 知識庫建設，共同推動 GEO 領域發展。提供貢獻指南與最佳實務">
          <meta http-equiv="refresh" content="0; url=https://bless25min.github.io/AIOGEO-Knowledge/#/contributing">
          <link rel="canonical" href="https://bless25min.github.io/AIOGEO-Knowledge/#/contributing">
          <script>window.location.href='https://bless25min.github.io/AIOGEO-Knowledge/#/contributing';</script>
        </head>
        <body>
          <h1>參與貢獻 - AIOGEO 知識庫</h1>
          <p>正在重定向到 <a href="https://bless25min.github.io/AIOGEO-Knowledge/#/contributing">參與貢獻頁面</a></p>
          <p>如果沒有自動跳轉，請點擊上方連結。</p>
        </body>
        </html>
        EOF
        
        # 生成主要文章頁面
        cat > geo-fundamentals.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
          <meta charset="UTF-8">
          <title>GEO基礎原理完整指南 | AIOGEO 知識庫</title>
          <meta name="description" content="深入解析 GEO (Generative Engine Optimization) 基礎原理，提供AI搜尋時代的內容優化策略與實戰技巧">
          <meta http-equiv="refresh" content="0; url=https://bless25min.github.io/AIOGEO-Knowledge/#/posts/geo-fundamentals">
          <link rel="canonical" href="https://bless25min.github.io/AIOGEO-Knowledge/#/posts/geo-fundamentals">
          <script>window.location.href='https://bless25min.github.io/AIOGEO-Knowledge/#/posts/geo-fundamentals';</script>
        </head>
        <body>
          <h1>GEO基礎原理完整指南</h1>
          <p>正在重定向到 <a href="https://bless25min.github.io/AIOGEO-Knowledge/#/posts/geo-fundamentals">GEO基礎原理頁面</a></p>
          <p>如果沒有自動跳轉，請點擊上方連結。</p>
        </body>
        </html>
        EOF
        
    - name: Generate optimized sitemap
      run: |
        cat > sitemap.xml << 'EOF'
        <?xml version="1.0" encoding="UTF-8"?>
        <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
            <!-- 主頁面 -->
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/</loc>
                <lastmod>$(date +%Y-%m-%d)</lastmod>
                <changefreq>weekly</changefreq>
                <priority>1.0</priority>
            </url>
            
            <!-- 靜態重定向頁面 -->
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/about.html</loc>
                <lastmod>$(date +%Y-%m-%d)</lastmod>
                <changefreq>monthly</changefreq>
                <priority>0.8</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/contributing.html</loc>
                <lastmod>$(date +%Y-%m-%d)</lastmod>
                <changefreq>monthly</changefreq>
                <priority>0.6</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals.html</loc>
                <lastmod>$(date +%Y-%m-%d)</lastmod>
                <changefreq>weekly</changefreq>
                <priority>0.95</priority>
            </url>
            
            <!-- Hash URLs for backup indexing -->
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/#!/about</loc>
                <lastmod>$(date +%Y-%m-%d)</lastmod>
                <changefreq>monthly</changefreq>
                <priority>0.7</priority>
            </url>
            <url>
                <loc>https://bless25min.github.io/AIOGEO-Knowledge/#!/posts/geo-fundamentals</loc>
                <lastmod>$(date +%Y-%m-%d)</lastmod>
                <changefreq>weekly</changefreq>
                <priority>0.9</priority>
            </url>
        </urlset>
        EOF
        
        # 替換日期變數
        sed -i "s/\$(date +%Y-%m-%d)/$(date +%Y-%m-%d)/g" sitemap.xml
        
    - name: Generate robots.txt
      run: |
        cat > robots.txt << 'EOF'
        User-agent: *
        Allow: /
        
        # Sitemap location
        Sitemap: https://bless25min.github.io/AIOGEO-Knowledge/sitemap.xml
        
        # Specific AI bot permissions
        User-agent: GPTBot
        Allow: /
        
        User-agent: Claude-Web
        Allow: /
        
        User-agent: PerplexityBot
        Allow: /
        EOF
        
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git diff --staged --quiet || git commit -m "🤖 自動生成 SEO 優化檔案 - $(date +%Y-%m-%d)"
        git push
