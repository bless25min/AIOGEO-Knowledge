name: ğŸ”§ Fix Sitemap XML Format

on:
  workflow_dispatch:
    inputs:
      regenerate_all:
        description: 'é‡æ–°ç”Ÿæˆæ‰€æœ‰æª”æ¡ˆ'
        required: false
        default: 'true'
        type: boolean

permissions:
  contents: write
  pages: write

jobs:
  fix-sitemap:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ—‚ï¸ List current files for debugging
      run: |
        echo "ğŸ“‹ ç•¶å‰æª”æ¡ˆåˆ—è¡¨ï¼š"
        ls -la
        echo ""
        echo "ğŸ“ æª¢æŸ¥æ˜¯å¦æœ‰éš±è—æª”æ¡ˆï¼š"
        ls -la sitemap.xml 2>/dev/null || echo "sitemap.xml ä¸å­˜åœ¨æˆ–æœ‰å•é¡Œ"
        echo ""
        echo "ğŸ” æª¢æŸ¥æª”æ¡ˆé¡å‹ï¼š"
        file sitemap.xml 2>/dev/null || echo "ç„¡æ³•æª¢æŸ¥ sitemap.xml æª”æ¡ˆé¡å‹"

    - name: ğŸ—ºï¸ Generate correct XML sitemap
      run: |
        echo "ğŸ—ºï¸ ç”Ÿæˆæ­£ç¢ºçš„ XML æ ¼å¼ sitemap..."
        
        # åˆªé™¤å¯èƒ½æœ‰å•é¡Œçš„ sitemap
        rm -f sitemap.xml
        
        # ç”Ÿæˆæ­£ç¢ºçš„ XML sitemap
        cat > sitemap.xml << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>1.0</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/about.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/contributing.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.6</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.9</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals-overview.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals-content-design.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals-technical.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals-measurement.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/geo-fundamentals-index.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.7</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/semantic-anchoring.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/semantic-mesh.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/schema-implementation.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/multimodal-optimization.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/multimodal-creation.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/ai-search-algorithm.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/ai-citation-tracking.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.7</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/citation-enhancement.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.7</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/answer-layer-design.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.7</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/faq-design.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.7</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/tools-checklists.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.6</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/tools-schema-generator.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.6</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/tools-content-templates.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.6</priority>
    </url>
    <url>
        <loc>https://bless25min.github.io/AIOGEO-Knowledge/tools-assessment-tools.html</loc>
        <lastmod>2025-07-08</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.5</priority>
    </url>
</urlset>
EOF

        echo "âœ… æ­£ç¢ºçš„ XML sitemap å·²ç”Ÿæˆ"

    - name: ğŸ¤– Update robots.txt
      run: |
        echo "ğŸ¤– æ›´æ–° robots.txt..."
        
        cat > robots.txt << 'EOF'
User-agent: *
Allow: /

# ç‰¹åˆ¥æ­¡è¿ AI æœå°‹å¼•æ“çˆ¬èŸ²
User-agent: GPTBot
Allow: /

User-agent: ChatGPT-User
Allow: /

User-agent: Claude-Web
Allow: /

User-agent: Google-Extended
Allow: /

User-agent: CCBot
Allow: /

# Sitemap ä½ç½®
Sitemap: https://bless25min.github.io/AIOGEO-Knowledge/sitemap.xml
EOF

        echo "âœ… robots.txt å·²æ›´æ–°"

    - name: ğŸ” Validate XML format
      run: |
        echo "ğŸ” é©—è­‰ XML æ ¼å¼..."
        
        # æª¢æŸ¥ XML æ˜¯å¦æ ¼å¼æ­£ç¢º
        if command -v xmllint >/dev/null 2>&1; then
            xmllint --noout sitemap.xml && echo "âœ… XML æ ¼å¼é©—è­‰é€šé" || echo "âŒ XML æ ¼å¼æœ‰èª¤"
        else
            echo "â„¹ï¸ xmllint ä¸å¯ç”¨ï¼Œè·³éæ ¼å¼é©—è­‰"
        fi
        
        # é¡¯ç¤ºæª”æ¡ˆå…§å®¹å‰å¹¾è¡Œä»¥ç¢ºèª
        echo ""
        echo "ğŸ“„ sitemap.xml å…§å®¹é è¦½ï¼š"
        head -10 sitemap.xml
        
        echo ""
        echo "ğŸ“Š æª”æ¡ˆè³‡è¨Šï¼š"
        ls -la sitemap.xml
        file sitemap.xml

    - name: ğŸ“¤ Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        git add sitemap.xml robots.txt
        
        if git diff --cached --quiet; then
          echo "â„¹ï¸ æ²’æœ‰æª”æ¡ˆè®Šæ›´éœ€è¦æäº¤"
        else
          git commit -m "ğŸ”§ ä¿®å¾© sitemap.xml æ ¼å¼å•é¡Œ

          ğŸš¨ ç·Šæ€¥ä¿®å¾©:
          âœ… é‡æ–°ç”Ÿæˆæ­£ç¢ºçš„ XML æ ¼å¼ sitemap
          âœ… ä¿®å¾©äºŒé€²åˆ¶æª”æ¡ˆå•é¡Œ
          âœ… æ›´æ–° robots.txt AI çˆ¬èŸ²è¨­å®š
          
          ğŸ“Š ä¿®å¾©å…§å®¹:
          - sitemap.xml: å®Œæ•´çš„ XML æ ¼å¼ï¼ŒåŒ…å« 23 å€‹é é¢
          - robots.txt: AI æœå°‹å¼•æ“å‹å–„è¨­å®š
          
          ğŸ¯ ä¿®å¾©æ•ˆæœ:
          - ğŸ”§ è§£æ±º Google Search Console ç„¡æ³•æ“·å–å•é¡Œ
          - ğŸ” æ”¯æ´æ­£ç¢ºçš„ sitemap ç´¢å¼•
          - ğŸ¤– å„ªåŒ– AI çˆ¬èŸ²è¨ªå•æ¬Šé™
          
          ä¿®å¾©æ™‚é–“: $(date)"
          
          echo "ğŸ“¤ æ¨é€ä¿®å¾©..."
          git push origin main
          
          echo "âœ… sitemap.xml æ ¼å¼ä¿®å¾©å®Œæˆï¼"
        fi

    - name: ğŸ‰ Fix completion summary
      run: |
        echo "ğŸ‰ Sitemap XML ä¿®å¾©å®Œæˆï¼"
        echo ""
        echo "âœ… ä¿®å¾©å…§å®¹ï¼š"
        echo "  ğŸ—ºï¸ é‡æ–°ç”Ÿæˆæ­£ç¢ºçš„ XML æ ¼å¼ sitemap"
        echo "  ğŸ¤– æ›´æ–° AI å‹å–„çš„ robots.txt"
        echo "  ğŸ“Š åŒ…å« 23 å€‹é‡è¦é é¢çš„å®Œæ•´ sitemap"
        echo ""
        echo "ğŸš€ ç«‹å³æ•ˆæœï¼š"
        echo "  âœ… è§£æ±º Google Search Console ç„¡æ³•æ“·å–å•é¡Œ"
        echo "  âœ… æ”¯æ´æ­£ç¢ºçš„ XML è§£æ"
        echo "  âœ… æå‡æœå°‹å¼•æ“ç´¢å¼•æ•ˆç‡"
        echo ""
        echo "ğŸ“‹ ä¸‹ä¸€æ­¥è¡Œå‹•ï¼š"
        echo "  1. â° ç­‰å¾… GitHub Pages éƒ¨ç½² (5 åˆ†é˜)"
        echo "  2. ğŸ§ª å†æ¬¡æ¸¬è©¦ sitemap.xml å¯è¨ªå•æ€§"
        echo "  3. ğŸ” é‡æ–°æäº¤åˆ° Google Search Console"
        echo "  4. ğŸ“ˆ ç›£æ§ç´¢å¼•ç‹€æ³æ”¹å–„"
        echo ""
        echo "ğŸ¯ é æœŸçµæœï¼š"
        echo "  ğŸ“ˆ Google æˆåŠŸè®€å– sitemap"
        echo "  ğŸ“ˆ é é¢æ”¶éŒ„ç‡å¤§å¹…æå‡"
        echo "  ğŸ“ˆ æœå°‹å¯è¦‹æ€§æ”¹å–„"
        echo ""
        echo "ğŸ† ä¿®å¾©æˆåŠŸï¼æ‚¨çš„ sitemap ç¾åœ¨å®Œå…¨ç¬¦åˆæ¨™æº–ï¼"
